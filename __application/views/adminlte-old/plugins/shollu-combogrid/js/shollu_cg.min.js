!function(t,e,a,i){"use strict";var n="shollu_cg",r="1.0.1",l={source:function(t,e){},onSelect:function(t){},onChange:function(t){},style:"bs3",menu_type:"normal",emptyMessage:"<center><b>No results were found</b></center>",page:1,rows:50,idField:"id",textField:"name",queryParams:{},item_cls:"",addition:{},list:{},remote:!1},o=function(e,a){function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,a="x"===t?e:3&e|8;return a.toString(16)})}function o(){return"bs3"==T.style?t('<div class="shollu_cg-container"><div class="input-group"><input type="hidden"><div class="input-group-btn"><span class="btn btn-default shollu_cg dropdown-toggle" data-dropdown="dropdown"><span class="caret" /></span></div></div></div>'):void 0}function s(){return t('<ul class="typeahead-long shollu_cg dropdown-menu dropdown-menu-right" />')}function d(){if(!j.data("init-shollu_cg")){j.data("init-shollu_cg",!0),j.before(S),P.before(j),P.attr("name",j.attr("name")),j.removeAttr("name"),T.disable=j.attr("disabled")===i?!1:j.attr("disabled")?!0:!1,u(T.disable),T.remote||Object.keys(T.list).length>0&&(t.each(T.list,function(t){var e=T.list[t][T.idField];T.list[t][T.textField];J[e]=T.list[t]}),T.rowData=J);var e=j.val();y(e)}return this}function c(){j.data("init-shollu_cg")&&(j.data("init-shollu_cg",!1),j.insertBefore(S),j.attr("name",P.attr("name")),j.val(P.val()),S.remove(),O(!1))}function u(t){j.prop("disabled",t),q.attr("disabled",t),T.disable=t,O(t?!1:!0)}function g(){var e=t.extend({},j.position(),{height:j[0].offsetHeight});M.insertAfter(j).css({top:e.top+e.height,left:e.left}).show(),T.shown=!0}function f(){M.hide(),t(".dropdown-menu").off("mousedown",function(t){"UL"==t.target.tagName}),T.shown=!1}function v(){N=!1,T.escape||(x(),!T.mousedover&&T.shown&&setTimeout(function(){f(),T.page=1},200))}function h(){T.shown&&f(),T.disable||(T.shown?(f(),j.focus()):p())}function p(){var e=j.attr("data-"+T.idField),a=j.attr("data-"+T.textField),i=j.val();if(i!=a&&(j.attr("value","").attr("data-"+T.idField,"").attr("data-"+T.textField,""),P.val("").trigger("change"),T.onChange.call(this,{}),e=""),T.remote){var n={page:T.page,rows:T.rows};e?n[T.idField]=e:i&&(n.q=i),t.each(T.queryParams,function(t,e){n[t]=e}),setTimeout(function(){t.getJSON(T.url,n,function(t){var e=t.data;Object.keys(e).length>0&&m(e)})},100)}else{"string"==typeof i&&(i=i.toUpperCase());var r=t.grep(T.list,function(t){return"string"==typeof t[T.idField]?t[T.idField].toUpperCase().indexOf(i)>=0:t[T.idField]==i}),l=t.grep(T.list,function(t){return"string"==typeof t[T.textField]?t[T.textField].toUpperCase().indexOf(i)>=0:t[T.textField]==i});m(t.extend({},r,l))}}function x(){var t=j.attr("data-"+T.idField),e=M.find(".active").data(T.idField),a=(j.attr("data-"+T.textField),M.find(".active").data(T.textField));j.val();return e===i?""!==t?(T.onSelect.call(this,T.rowData[t]),f()):(j.attr("value","").attr("data-"+T.idField,"").attr("data-"+T.textField,"").val("").trigger("change"),f()):""==e||""==t||T.mousedover?e===t?(Object.keys(T.addition).length>0&&0===e&&(j.attr("value",e).attr("data-"+T.idField,e).attr("data-"+T.textField,a).val(a).trigger("change"),P.val(e).trigger("change"),T.onSelect.call(this,T.rowData[e])),f()):e!=t&&T.escape?(j.attr("value","").attr("data-"+T.idField,"").attr("data-"+T.textField,"").val("").trigger("change"),M.find(".active").removeClass("active"),T.escape=!1,f()):e==t||T.mousedover?e!==t?(j.attr("value",e).attr("data-"+T.idField,e).attr("data-"+T.textField,a).val(a).trigger("change"),P.val(e).trigger("change"),T.onSelect.call(this,T.rowData[e]),f()):void 0:T.tabenter?(j.attr("value",e).attr("data-"+T.idField,e).attr("data-"+T.textField,a).val(a).trigger("change"),P.val(e).trigger("change"),T.onSelect.call(this,T.rowData[e]),T.tabenter=!1,f()):(j.attr("value","").attr("data-"+T.idField,"").attr("data-"+T.textField,"").val("").trigger("change"),M.find(".active").removeClass("active"),f()):(M.find(".active").removeClass("active"),f())}function m(e){var a=[],i=e,n=j.attr("data-"+T.idField),r=j.val();1==T.page&&M.empty(),T.remote&&(i=e.rows,$=Math.ceil(e.total/T.rows)),Object.keys(T.addition).length>0&&i.unshift(T.addition),Object.keys(i).length>0?(t.each(i,function(e){var l=i[e][T.idField],o=i[e][T.textField];T.item_cls?'class="'+T.item_cls+'" ':"";r=r.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var s=new RegExp("("+r.split(" ").join("|")+")","gi"),d=t("<li data-"+T.idField+'="'+l+'" data-'+T.textField+'="'+o+'"><a>'+o.replace(s,"<b>$1</b>")+"</a></li>");T.item_cls&&d.addClass(T.item_cls),n&&n==l&&d.addClass("active"),r&&r==o.toLowerCase()&&(d.hasClass("active")||d.addClass("active")),a.push(d),J[l]=i[e]}),M.append(a)):M.append('<span style="color:#999;">'+T.emptyMessage+"</span>"),T.rowData=J,g(),j.focus(),F()}function F(){var t=M.find(".active");if(t.length){var e=t.position().top,a=e+t.height(),i=M.scrollTop(),n=M.height();a>n?M.scrollTop(i+a-n):0>e&&M.scrollTop(i+e)}}function w(t){var e;return t=t===i?T.idField:t,(e=j.attr("value")===i?"":""==j.attr("value")?"":j.attr("value"))&&j.attr("value")?(e=T.rowData[j.attr("value")][t])===i?!1:e:void 0}function y(e){if(j.data("init-shollu_cg")!==!1){if(!e||0>e)return j.attr("value","").attr("data-"+T.idField,"").attr("data-"+T.textField,"").val("").trigger("change"),P.val("").trigger("change"),void T.onChange.call(this,{});if(T.remote)setTimeout(function(){t.getJSON(T.url,{id:e},function(t){var e=t.data.rows[0];if("undefined"!=typeof e){var a=e[T.idField],i=e[T.textField];j.attr("value",a).attr("data-"+T.idField,a).attr("data-"+T.textField,i).val(i).trigger("change"),P.val(a).trigger("change"),T.selected=!0,J[a]=e,T.rowData=J,T.onChange.call(this,T.rowData[a])}else j.attr("value","").attr("data-"+T.idField,"").attr("data-"+T.textField,"").val("").trigger("change"),P.val("").trigger("change"),T.onChange.call(this,{})})},100);else if(Object.keys(T.list).length>0)if(T.rowData[e]!==i){var a=T.rowData[e][T.idField],n=T.rowData[e][T.textField];j.attr("value",a).attr("data-"+T.idField,a).attr("data-"+T.textField,n).val(n).trigger("change"),P.val(a).trigger("change"),T.selected=!0,T.onChange.call(this,T.rowData[a])}else j.attr("value","").attr("data-"+T.idField,"").attr("data-"+T.textField,"").val("").trigger("change"),P.val("").trigger("change"),T.onChange.call(this,{})}}function b(e){j.focus(),e.stopPropagation(),e.preventDefault();var a=(e.currentTarget.scrollTop+t(e.currentTarget).height())/e.currentTarget.scrollHeight*100;if(a>90&&!U&&T.page<$&&(U=!0,T.page++,T.remote)){var i=j.val(),n={q:i,page:T.page,rows:T.rows};t.each(T.queryParams,function(t,e){n[t]=e}),setTimeout(function(){t.getJSON(T.url,n,function(t){var e=t.data;Object.keys(e).length>0&&m(e),U=!1})},100)}}function k(){var e=M.find(".active").removeClass("active"),a=e.next();a.length||(a=t(M.find("li")[0])),a.addClass("active")}function C(){var t=M.find(".active").removeClass("active"),e=t.prev();e.length||(e=M.find("li").last()),e.addClass("active")}function _(t){if(T.shown){switch(t.keyCode){case 9:case 13:case 27:t.preventDefault();break;case 38:t.preventDefault(),C(),F();break;case 40:t.preventDefault(),k(),F()}t.stopPropagation()}}function D(t){switch(t.keyCode){case 40:T.shown||h();break;case 39:case 38:case 37:case 36:case 35:case 16:case 17:case 18:break;case 9:case 13:if(!T.shown)return;T.tabenter=!0,x();break;case 27:if(!T.shown)return;T.escape=!0,x();break;default:p()}t.stopPropagation(),t.preventDefault()}function O(e){e?(j.on("focus",function(){N=!0}).on("blur",v).on("keypress",function(t){A||_(t)}).on("keydown",function(e){A=~t.inArray(e.keyCode,[40,38,9,13,27]),_(e)}).on("keyup",D).on("dblclick",h),M.on("click",function(t){j.focus(),t.stopPropagation(),t.preventDefault(),x()}).on("mouseenter","li",function(e){T.mousedover=!0,M.find(".active").removeClass("active"),t(e.currentTarget).addClass("active")}).on("mouseleave",function(){T.mousedover=!1}).scroll(b),q.on("click",h)):(j.off("blur focusout focus keydown keyup keypress dblclick"),M.off("click mouseenter mouseleave scroll"),q.off("click"))}var T=a;T.guid=l();var j=t(e),S=o(),P=S.find("input[type=hidden]"),q=S.find("span.shollu_cg.dropdown-toggle"),M=s(),N=!1,A={},U=!1,J={},$=1;T.escape=!1,T.tabenter=!1,this.name=n,this.version=r+" ("+T.guid+")",this.guid=T.guid,this.o=T,this.destroy=function(){c()},this.getValue=function(t){return w(t)},this.setValue=function(t){y(t)},this.select=function(){x()},this.disable=function(t){u(t)},this.init=function(){d()},d()};t.fn.shollu_cg=function(e){var a=t(this),i=a.data("shollu_cg");if("string"==typeof e){if(!i)return this;if(i[e])return t.isFunction(i[e])?i[e].apply(i,Array.prototype.slice.call(arguments,1)):i[e];t.error("Method "+e+" does not exist on jQuery.shollu_cg")}return this.each(function(){i?(i.o=t.extend(i.o,e),a.data("shollu_cg",i)):a.data("shollu_cg",new o(this,t.extend({},l,e)))})}}(jQuery);