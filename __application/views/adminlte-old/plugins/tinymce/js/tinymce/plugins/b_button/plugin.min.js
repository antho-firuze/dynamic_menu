tinymce.PluginManager.add("b_button",function(t){function e(e){return function(){var n=t.settings.link_list;"string"==typeof n?tinymce.util.XHR.send({url:n,success:function(t){e(tinymce.util.JSON.parse(t))}}):"function"==typeof n?n(e):e(n)}}function n(t,e,n){function i(t,n){return n=n||[],tinymce.each(t,function(t){var s={text:t.text||t.title};t.menu?s.menu=i(t.menu):(s.value=t.value,e&&e(s)),n.push(s)}),n}return i(t,n||[])}function i(e){function i(t){var e=g.find("#text");(!e.value()||t.lastControl&&e.value()==t.lastControl.text())&&e.value(t.control.text()),g.find("#href").value(t.control.value())}function s(e){var n=[];return tinymce.each(t.dom.select("a:not([href])"),function(t){var i=t.name||t.id;i&&n.push({text:i,value:"#"+i,selected:-1!=e.indexOf("#"+i)})}),n.length?(n.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:n,onselect:i}):void 0}function l(){!c&&0===w.text.length&&f&&this.parent().parent().find("#text")[0].value(this.value())}function a(e){var n=e.meta||{};b&&b.value(t.convertURL(this.value(),"href")),tinymce.each(e.meta,function(t,e){g.find("#"+e).value(t)}),n.text||l.call(this)}function o(t){var e=C.getContent();if(/</.test(e)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(e)||-1==e.indexOf("href=")))return!1;if(t){var n,i=t.childNodes;if(0===i.length)return!1;for(n=i.length-1;n>=0;n--)if(3!=i[n].nodeType)return!1}return!0}var r,u,c,g,f,x,b,d,v,m,h,_,p,y,k,w={},C=t.selection,T=t.dom;r=C.getNode(),u=T.getParent(r,"a[href]"),f=o(),w.text=c=u?u.innerText||u.textContent:C.getContent({format:"text"}),u?w.target=T.getAttrib(u,"target"):t.settings.default_link_target&&(w.target=t.settings.default_link_target),(_=T.getAttrib(u,"rel"))&&(w.rel=_),(_=T.getAttrib(u,"btn_class"))&&(w.btn_class=_),(_=T.getAttrib(u,"size_class"))&&(w.size_class=_),(_=T.getAttrib(u,"title"))&&(w.title=_),w.href=u?T.getAttrib(u,"href"):"",(_=T.getAttrib(u,"linkstats"))&&(w.linkstats=_),f&&(x={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){w.text=this.value()}}),e&&(b={type:"listbox",label:"Link list",values:n(e,function(e){e.value=t.convertURL(e.value||e.url,"href")},[{text:"None",value:""}]),onselect:i,value:t.convertURL(w.href,"href"),onPostRender:function(){b=this}}),t.settings.target_list!==!1&&(t.settings.target_list||(t.settings.target_list=[{text:"None",value:""},{text:"New window",value:"_blank"}]),v={name:"target",type:"listbox",label:"Target",values:n(t.settings.target_list)}),t.settings.btn_class!==!1&&(t.settings.btn_class||(t.settings.btn_class=[{text:"Default",value:"btn btn-default"},{text:"Primary",value:"btn btn-primary"},{text:"Success",value:"btn btn-success"},{text:"Info",value:"btn btn-info"},{text:"Warning",value:"btn btn-warning"},{text:"Danger",value:"btn btn-danger"}]),p={name:"btn_class",type:"listbox",label:"Button Class",values:n(t.settings.btn_class)}),t.settings.size_class!==!1&&(t.settings.size_class||(t.settings.size_class=[{text:"None",value:""},{text:"Large",value:" btn-lg"},{text:"Small",value:" btn-sm"},{text:"Extra Small",value:" btn-xs"}]),k={name:"size_class",type:"listbox",label:"Size Class",values:n(t.settings.size_class)}),t.settings.rel_list&&(d={name:"rel",type:"listbox",label:"Rel",values:n(t.settings.rel_list)}),t.settings.link_title!==!1&&(h={name:"title",type:"textbox",label:"Title",value:w.title}),t.settings.linkstats!==!1&&(y={name:"linkstats",type:"textbox",label:"Linkstats index number",value:w.linkstats}),g=t.windowManager.open({title:"Insert Bootstrap Button",data:w,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:a,onkeyup:l},x,h,s(w.href),b,d,y,v,m,p,k],onSubmit:function(e){function n(e,n){var i=t.selection.getRng();tinymce.util.Delay.setEditorTimeout(t,function(){t.windowManager.confirm(e,function(e){t.selection.setRng(i),n(e)})})}function i(){var e={target:w.target?w.target:null,rel:w.rel?w.rel:null,"class":w.btn_class+w.size_class,title:w.title?w.title:null,role:"button",href:s,linkstats:w.linkstats?w.linkstats:null};u?(t.focus(),f&&w.text!=c&&("innerText"in u?u.innerText=w.text:u.textContent=w.text),T.setAttribs(u,e),C.select(u),t.undoManager.add()):f?t.insertContent(T.createHTML("a",e,T.encode(w.text))):t.execCommand("mceInsertLink",!1,e)}var s;return w=tinymce.extend(w,e.data),(s=w.href)?s.indexOf("@")>0&&-1==s.indexOf("//")&&-1==s.indexOf("mailto:")?void n("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(t){t&&(s="mailto:"+s),i()}):t.settings.link_assume_external_targets&&!/^\w+:/i.test(s)||!t.settings.link_assume_external_targets&&/^\s*www[\.|\d\.]/i.test(s)?void n("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(t){t&&(s="http://"+s),i()}):void i():void t.execCommand("unlink")}})}t.addButton("b_button",{icon:"glyphicons guicon guicon-button",tooltip:"Insert Button",onclick:e(i)}),this.showDialog=i,t.addMenuItem("b_button",{icon:"glyphicons guicon guicon-button",text:"Button",onclick:e(i),context:"insert",prependToContext:!0})});